<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <title>Geolocation Tracking</title>
    <script>
var snd=new Audio("process.mp3");
var xhr= new XMLHttpRequest();
var locations=[];
var lat, lng;
    window.onload = function(){
//サーバーから登録位置情報を引っ張る
xhr.open("GET","http://www.nyanchangames.com/geoServer.php?action=retrieve");//とりあえずうちのサーバになってる
xhr.send();
xhr.addEventListener("load",function(ev){//結果が返ってきたときにコールバック
var tmp=xhr.response.split("\n");//貰ったデータを、まずは1件1件に分ける
for(var i=0;i<tmp.length;i++){//次は値ごとに分けて2次元配列にぶっこむ
var tmp2=tmp[i].split(",");
locations[i]=[tmp2[0],tmp2[1],tmp2[2]]
}
xhr.removeEventListener("load", arguments.callee, false);
});
    }

function startTracking(){
document.getElementById("main").innerHTML="<p>アプリケーションが動作中です。</p>";
document.getElementById("btn").innerHTML='<p><button type="button" onclick="postLocation();">現在地を登録</button></p>';
snd.load();
        navigator.geolocation.watchPosition(update); //現在位置情報を定期的に監視
}

    function update(position){
snd.play();
        //下記すべての情報が取得できるわけでは無い
        lat = position.coords.latitude; //緯度
        lng = position.coords.longitude; //経度
        var alt = position.coords.altiude; //高度
        var acc = position.coords.accuracy; //緯度経度の誤差
        var alc = position.coords.altiudeAccuracy; //高度の誤差
        var hed = position.coords.heading; //方角
        var spe = position.coords.speed; //スピード

        var txt  = "緯度:" + lat + "<br>";
            txt += "経度:" + lng + "<br>";
            txt += "高度:" + alt + "<br>";
            txt += "緯度経度誤差:" + acc + "<br>";
            txt += "高度誤差:" + alc + "<br>";
            txt += "方角:" + hed + "<br>";
            txt += "速度:" + spe + "<br>";    
        document.getElementById("result").innerHTML = txt;
    }
function postLocation(){
xhr.open("GET","http://www.nyanchangames.com/geoServer.php?action=register&i="+lat+"&k="+lng);//とりあえずうちのサーバになってる
xhr.send();
xhr.addEventListener("load",function(ev){//結果が返ってきたときにコールバック
alert(xhr.response);
xhr.removeEventListener("load", arguments.callee, false);
});
}

    </script>
</head>
<body>

<div id="main">
    <p>トラッキングを開始するには、「スタート」ボタンを押してください。</p>
<button type="button" onclick="startTracking();">スタート</button>
</div>
<div id="btn"></div>
    <div id="result"></div>
</body>
</html>